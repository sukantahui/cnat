import{j as e}from"./index-BFnLuail.js";import{c as i}from"./clsx-B-dksMZM.js";import{S as n}from"./ShellFileLoader-BgOvPFCh.js";import"./prism-DTsTe1iV.js";const x=`#!/bin/bash
# cleanup_temp.sh ‚Äì removes scratch files on exit or interrupt
TMPFILE=$(mktemp /tmp/example.XXXXXX)
echo "Working with $TMPFILE" > "$TMPFILE"

cleanup() {
    rm -f "$TMPFILE"
    echo "Cleaned up $TMPFILE"
}

trap cleanup EXIT INT TERM

# simulate work
sleep 5`,h=`#!/bin/bash
# graceful_shutdown.sh ‚Äì common handler for multiple signals
shutdown() {
    echo "Received $1 ‚Äì shutting down gracefully"
    # kill background jobs, close connections, etc.
    exit 0
}

trap 'shutdown SIGINT'  INT
trap 'shutdown SIGTERM' TERM
trap 'shutdown EXIT'    EXIT

echo "Running... press Ctrl+C or kill me"
while true; do sleep 2; done`,m=`#!/bin/bash
# critical_section.sh ‚Äì ignore Ctrl+C during sensitive operation
echo "Critical operation ‚Äì Ctrl+C disabled"
trap '' INT
sleep 3
echo "Critical part finished ‚Äì restoring Ctrl+C"
trap - INT
sleep 3
echo "Normal operation, you can interrupt now"`,g=`#!/bin/bash
# ping_with_lock.sh ‚Äì production lock handling
LOCKFILE="/tmp/ping_monitor.lock"
exec 200>"$LOCKFILE"
flock -n 200 || exit 1  # fail if already running

cleanup() {
    flock -u 200
    rm -f "$LOCKFILE"
    echo "Lock released"
}
trap cleanup EXIT INT TERM

ping -c 10 google.com > /tmp/ping_output.log`,o=document.createElement("style");o.textContent=`
  @keyframes fadeIn {
    from { opacity: 0; }
    to   { opacity: 1; }
  }
  @keyframes slideUp {
    from { transform: translateY(20px); opacity: 0; }
    to   { transform: translateY(0); opacity: 1; }
  }
`;document.head.appendChild(o);function y(){const r=new Date().getFullYear()-1998,s="motion-safe:animate-[fadeIn_0.6s_ease-out,slideUp_0.6s_ease-out]";return e.jsx("div",{className:"dark",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-12 bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100 leading-relaxed space-y-14",children:[e.jsxs("header",{className:i(s,"space-y-4"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-1.5 h-12 bg-gradient-to-b from-indigo-500 to-cyan-400 rounded-full"}),e.jsx("h1",{className:"text-4xl font-light tracking-tight text-gray-800 dark:text-gray-100",children:"Traps & Signals"})]}),e.jsx("p",{className:"text-xl text-gray-600 dark:text-gray-400 ml-4 border-l-4 border-indigo-300 pl-5 italic",children:"‚ÄúMake your scripts resilient ‚Äì catch signals, clean up, and exit gracefully.‚Äù"}),e.jsx(d,{experience:r})]}),e.jsxs(t,{title:"üß† 1. Signals ‚Äì The Kernel's Way to Talk",delay:"100",className:s,children:[e.jsxs("p",{className:"mb-3",children:["In Linux, a ",e.jsx("span",{className:"font-mono text-indigo-600 dark:text-indigo-400",children:"signal"})," is a software interrupt delivered to a process. It notifies the process that an event has occurred. Common signals:"]}),e.jsxs("ul",{className:"list-disc pl-8 space-y-1 text-gray-700 dark:text-gray-300",children:[e.jsxs("li",{children:[e.jsx("span",{className:"font-mono font-semibold",children:"SIGINT"})," (2) ‚Äì Interactive attention (Ctrl+C)."]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-mono font-semibold",children:"SIGTERM"})," (15) ‚Äì Termination request (default ",e.jsx("code",{children:"kill"}),")."]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-mono font-semibold",children:"SIGEXIT"})," (0) ‚Äì ",e.jsx("span",{className:"italic",children:"Pseudo‚Äësignal"}),", runs when the shell exits."]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-mono font-semibold",children:"SIGHUP"})," (1), ",e.jsx("span",{className:"font-mono font-semibold",children:"SIGKILL"})," (9), ‚Ä¶"]})]}),e.jsxs("p",{className:"mt-4",children:["Without a ",e.jsx("strong",{children:"trap"}),", the default action (often termination) is taken. The ",e.jsx("code",{className:"text-sm bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded",children:"trap"})," built‚Äëin lets you intercept signals and execute custom commands."]}),e.jsxs("div",{className:"mt-8 p-6 bg-gray-50/80 dark:bg-gray-900/60 rounded-2xl border border-gray-200 dark:border-gray-800 hover:shadow-lg transition-shadow duration-300 group",children:[e.jsxs("h3",{className:"text-lg font-medium mb-5 flex items-center gap-2",children:[e.jsx("span",{className:"text-indigo-500",children:"‚ö°"})," Signal propagation (INT ‚Üí trap ‚Üí handler)"]}),e.jsx(p,{})]})]}),e.jsx(t,{title:"‚öôÔ∏è 2. trap ‚Äì Signature & Semantics",delay:"200",className:s,children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-mono text-sm bg-gray-800 text-gray-100 p-3 rounded-md inline-block",children:"trap ['command'] signal [signal ...]"}),e.jsxs("ul",{className:"mt-4 space-y-2 text-gray-700 dark:text-gray-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Purpose:"})," Set a handler that runs when the shell receives one or more signals."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Return:"})," Always 0 (unless invalid syntax)."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Special uses:"}),e.jsxs("ul",{className:"pl-6 list-disc mt-1",children:[e.jsxs("li",{children:[e.jsx("code",{children:"trap - signal"})," ‚Üí reset to default."]}),e.jsxs("li",{children:[e.jsx("code",{children:"trap '' signal"})," ‚Üí ignore signal."]}),e.jsxs("li",{children:[e.jsx("code",{children:"trap -p"})," ‚Üí list current traps."]}),e.jsxs("li",{children:[e.jsx("code",{children:"trap 'cmd' EXIT"})," ‚Üí run on any script exit."]})]})]})]}),e.jsxs(l,{children:[e.jsx("strong",{children:"Think about‚Ä¶"})," The command string is evaluated when the signal arrives, not when ",e.jsx("code",{children:"trap"})," is declared. Use single quotes or escape variables if you need their value at trap time."]})]}),e.jsxs("div",{className:"bg-indigo-50/30 dark:bg-indigo-950/30 p-5 rounded-xl border border-indigo-200 dark:border-indigo-900 hover:scale-[1.01] transition-transform",children:[e.jsx("h4",{className:"font-semibold text-indigo-700 dark:text-indigo-300 mb-3",children:"üìò When & why"}),e.jsxs("p",{className:"text-sm",children:["Use traps to:",e.jsx("br",{}),"‚úÖ Remove temporary files (always).",e.jsx("br",{}),"‚úÖ Flush buffers / save state.",e.jsx("br",{}),"‚úÖ Kill child processes before exiting.",e.jsx("br",{}),"‚úÖ Print a friendly message instead of a hard crash.",e.jsx("br",{}),"‚úÖ Prevent Ctrl+C from aborting critical sections."]})]})]})}),e.jsxs(t,{title:"üßπ 3. Real‚Äëworld: Cleaning up temporary files",delay:"300",className:s,children:[e.jsxs("p",{className:"mb-4",children:[e.jsx("span",{className:"bg-yellow-100 dark:bg-yellow-900/40 px-2 py-0.5 rounded",children:"Scenario"})," ‚Äì Swadeep from Barrackpore writes a script that creates scratch files. He uses ",e.jsx("code",{children:"trap"})," to delete them even if the script is interrupted."]}),e.jsx(n,{fileModule:x,title:"cleanup_temp.sh ‚Äì Trap INT + EXIT",highlightLines:[4,5,9,13]}),e.jsxs("div",{className:"mt-6 p-5 bg-amber-50/70 dark:bg-amber-950/40 rounded-lg border border-amber-300 dark:border-amber-800 flex items-start gap-3",children:[e.jsx("span",{className:"text-amber-700 dark:text-amber-400 text-2xl",children:"üí°"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Professional tip:"})," Always trap ",e.jsx("code",{children:"EXIT"})," ‚Äì it fires even on normal exit, and you avoid repeating cleanup code. Tuhina uses this pattern in all her data‚Äëprocessing pipelines."]})]})]}),e.jsxs(t,{title:"üõ°Ô∏è 4. Ignoring signals & resetting traps",delay:"400",className:s,children:[e.jsxs("p",{className:"mb-2",children:["To temporarily disable Ctrl+C during a critical operation, set ",e.jsx("code",{children:"trap '' INT"}),". Later, restore it with ",e.jsx("code",{children:"trap - INT"}),"."]}),e.jsx(n,{fileModule:m,title:"critical_section.sh ‚Äì ignore & restore",highlightLines:[6,12,16]}),e.jsxs(l,{children:[e.jsx("strong",{children:"Try changing this‚Ä¶"})," Remove the second ",e.jsx("code",{children:"trap"})," ‚Äì what happens when you press Ctrl+C after the critical section? Debangshu discovered that ignoring signals persists; always restore!"]})]}),e.jsxs(t,{title:"üéõÔ∏è 5. Handling several signals with one function",delay:"500",className:s,children:[e.jsxs("p",{className:"mb-3",children:["Group cleanup or logging for ",e.jsx("code",{children:"INT"}),", ",e.jsx("code",{children:"TERM"}),", ",e.jsx("code",{children:"HUP"}),". Abhronila uses this in her server monitoring scripts."]}),e.jsx(n,{fileModule:h,title:"graceful_shutdown.sh ‚Äì common handler",highlightLines:[3,6,7]})]}),e.jsxs(t,{title:"üåê 6. Production scenario ‚Äì scheduled ping & log rotation",delay:"600",className:s,children:[e.jsxs("p",{className:"mb-3",children:["At Ichapur school lab, a cron job pings servers. The script must not leave stale lock files.",e.jsxs("span",{className:"block mt-1 text-gray-600 dark:text-gray-400 text-sm",children:["‚Üí Trap ",e.jsx("code",{children:"INT"})," and ",e.jsx("code",{children:"EXIT"})," to remove lock, even if killed."]})]}),e.jsx(n,{fileModule:g,title:"ping_with_lock.sh ‚Äì production ready",highlightLines:[7,8,21,26]})]}),e.jsxs("div",{className:i(s,"grid md:grid-cols-2 gap-8","[animation-delay:700ms]"),children:[e.jsxs("div",{className:"bg-red-50/50 dark:bg-red-950/30 p-6 rounded-xl border border-red-200 dark:border-red-900 hover:shadow-md transition",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-700 dark:text-red-400 mb-4 flex items-center gap-2",children:"‚ö†Ô∏è Beginner traps (pun intended)"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-2 text-sm text-gray-800 dark:text-gray-200",children:[e.jsx("li",{children:"‚ùå Using double quotes with variables that should be evaluated at signal time."}),e.jsx("li",{children:"‚ùå Forgetting that subshells do not inherit traps from parent."}),e.jsxs("li",{children:["‚ùå Trying to trap ",e.jsx("code",{children:"SIGKILL"})," (cannot be caught)."]}),e.jsx("li",{children:"‚ùå Not resetting traps in scripts that are sourced."}),e.jsxs("li",{children:["‚ùå Misunderstanding ",e.jsx("code",{children:"EXIT"})," ‚Äì it runs even on syntax errors."]})]})]}),e.jsxs("div",{className:"bg-green-50/50 dark:bg-green-950/30 p-6 rounded-xl border border-green-200 dark:border-green-900 hover:shadow-md transition",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-700 dark:text-green-400 mb-4 flex items-center gap-2",children:"‚úÖ Professional habits"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-2 text-sm text-gray-800 dark:text-gray-200",children:[e.jsxs("li",{children:["‚ûï Always trap ",e.jsx("code",{children:"EXIT"})," for cleanup ‚Äì it‚Äôs idempotent and covers all exits."]}),e.jsx("li",{children:"‚ûï Define handler functions for readability."}),e.jsxs("li",{children:["‚ûï Use ",e.jsx("code",{children:"trap -p"})," inside scripts to debug active traps."]}),e.jsx("li",{children:"‚ûï Put traps at the very top of the script."}),e.jsx("li",{children:"‚ûï In libraries, avoid overriding user traps without saving/restoring."})]})]})]}),e.jsxs("div",{className:i(s,"bg-indigo-50/70 dark:bg-indigo-950/40 p-6 rounded-2xl border border-indigo-300 dark:border-indigo-800","[animation-delay:800ms]"),children:[e.jsx("h3",{className:"text-xl font-medium text-indigo-800 dark:text-indigo-300 mb-3 flex items-center gap-2",children:"‚úÖ Mini checklist ‚Äì every script should‚Ä¶"}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-3 text-gray-800 dark:text-gray-200",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-indigo-600 dark:text-indigo-400",children:"‚ñπ"})," Clean up temporary files?"]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-indigo-600 dark:text-indigo-400",children:"‚ñπ"})," Handle Ctrl+C gracefully?"]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-indigo-600 dark:text-indigo-400",children:"‚ñπ"})," Kill background children on exit?"]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-indigo-600 dark:text-indigo-400",children:"‚ñπ"})," Restore terminal settings?"]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-indigo-600 dark:text-indigo-400",children:"‚ñπ"})," Log interruptions?"]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-indigo-600 dark:text-indigo-400",children:"‚ñπ"})," Reset ignored signals afterwards?"]})]})]}),e.jsx("div",{className:i(s,"mt-6","[animation-delay:900ms]"),children:e.jsx(d,{experience:r,detailed:!0})})]})})}function t({title:a,delay:r,className:s,children:c}){return e.jsxs("section",{className:i(s,"space-y-4",r&&`motion-safe:[animation-delay:${r}ms]`),children:[e.jsx("h2",{className:"text-2xl font-medium text-gray-800 dark:text-gray-100 border-b border-gray-300 dark:border-gray-700 pb-2",children:a}),c]})}function l({children:a}){return e.jsxs("div",{className:"mt-3 p-4 bg-blue-50/60 dark:bg-blue-950/40 rounded-lg border-l-4 border-blue-400 text-sm text-gray-700 dark:text-gray-200 hover:bg-blue-100/70 dark:hover:bg-blue-900/60 transition-colors",children:["üí≠ ",a]})}function d({experience:a,detailed:r=!1}){const s=e.jsxs("div",{className:"p-5 bg-amber-50/70 dark:bg-amber-950/40 rounded-xl border border-amber-300 dark:border-amber-800 hover:shadow-lg transition-shadow group",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-start",children:[e.jsx("div",{className:"bg-amber-200 dark:bg-amber-800 p-3 rounded-full group-hover:scale-110 transition-transform",children:"üßë‚Äçüè´"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-amber-800 dark:text-amber-300 text-lg",children:"Teacher's Note ‚Äì Sukanta Hui"}),e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-200 mt-1",children:[a," years of experience (since 1998) ‚Ä¢ Programming Languages, RDBMS, OS, Web Dev",e.jsx("br",{}),e.jsx("span",{className:"font-mono text-xs",children:"üìß sukantahui@codernaccotax.co.in"}),e.jsx("span",{className:"mx-2",children:"‚Ä¢"}),e.jsx("span",{className:"font-mono text-xs",children:"üì± 7003756860"})]})]})]}),r&&e.jsx("div",{className:"mt-4 text-sm text-gray-800 dark:text-gray-100 border-t border-amber-200 dark:border-amber-800 pt-4",children:e.jsxs("p",{className:"italic",children:["‚ÄúTraps are one of the first things I teach after basic commands. In 27+ years, I've seen countless scripts fail because they didn't clean up. Start with ",e.jsx("code",{children:"trap cleanup EXIT"})," ‚Äì it‚Äôs a game changer for Swadeep, Tuhina, and every student in Naihati batch.‚Äù"]})})]});return r?s:e.jsx("div",{className:"not-prose",children:s})}function p(){return e.jsxs("svg",{width:"100%",height:"120",viewBox:"0 0 600 120",className:"overflow-visible",children:[e.jsx("rect",{x:"40",y:"30",width:"100",height:"60",rx:"8",className:"fill-white dark:fill-gray-800 stroke-indigo-600 dark:stroke-indigo-400 stroke-2 transition-all duration-300 group-hover:stroke-3"}),e.jsx("text",{x:"90",y:"65",textAnchor:"middle",className:"fill-gray-800 dark:fill-gray-100 text-xs font-mono",children:"Script"}),e.jsx("rect",{x:"400",y:"40",width:"120",height:"40",rx:"6",className:"fill-gray-200 dark:fill-gray-700 stroke-gray-500 stroke-1"}),e.jsx("text",{x:"460",y:"65",textAnchor:"middle",className:"fill-gray-800 dark:fill-gray-200 text-xs",children:"Ctrl+C (SIGINT)"}),e.jsx("path",{id:"signalPath",d:"M400,60 L160,60",stroke:"#818cf8",strokeWidth:"2",strokeDasharray:"6 6",fill:"none"}),e.jsx("circle",{r:"8",className:"fill-red-500",children:e.jsx("animateMotion",{dur:"1.2s",repeatCount:"indefinite",path:"M400,60 L160,60"})}),e.jsx("rect",{x:"70",y:"70",width:"40",height:"20",rx:"4",className:"fill-amber-300 dark:fill-amber-600 stroke-amber-700 stroke-1"}),e.jsx("text",{x:"90",y:"85",textAnchor:"middle",className:"fill-gray-900 text-[9px] font-bold",children:"trap"}),e.jsx("path",{d:"M110,70 L220,20",stroke:"#34d399",strokeWidth:"2",strokeDasharray:"4 2"}),e.jsx("rect",{x:"220",y:"10",width:"80",height:"30",rx:"4",className:"fill-emerald-200 dark:fill-emerald-800 stroke-emerald-600 stroke-1"}),e.jsx("text",{x:"260",y:"30",textAnchor:"middle",className:"fill-gray-900 dark:fill-gray-100 text-[10px]",children:"cleanup()"}),e.jsx("text",{x:"520",y:"100",className:"fill-gray-500 dark:fill-gray-400 text-[10px]",children:"‚ñ≤ signal caught"})]})}export{y as default};
